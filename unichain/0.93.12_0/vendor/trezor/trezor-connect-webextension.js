!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TrezorConnect=t():e.TrezorConnect=t()}(self,(()=>(()=>{"use strict";var e={928:e=>{var t,n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,s){function i(n){e.removeListener(t,o),s(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&g(e,"error",t,n)}(e,i,{once:!0})}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var r=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function h(e,t,n,s){var i,o,r,h;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),r=o[t]),void 0===r)r=o[t]=n,++e._eventsCount;else if("function"==typeof r?r=o[t]=s?[n,r]:[r,n]:s?r.unshift(n):r.push(n),(i=c(e))>0&&r.length>i&&!r.warned){r.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=r.length,h=d,console&&console.warn&&console.warn(h)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,n){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=d.bind(s);return i.listener=n,s.wrapFn=i,i}function u(e,t,n){var s=e._events;if(void 0===s)return[];var i=s[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):m(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),s=0;s<t;++s)n[s]=e[s];return n}function g(e,t,n,s){if("function"==typeof e.on)s.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){s.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return r},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");r=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var r;if(t.length>0&&(r=t[0]),r instanceof Error)throw r;var a=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw a.context=r,a}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)s(c,this,t);else{var h=c.length,d=m(c,h);for(n=0;n<h;++n)s(d[n],this,t)}return!0},o.prototype.addListener=function(e,t){return h(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return h(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,l(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,l(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,s,i,o,r;if(a(t),void 0===(s=this._events))return this;if(void 0===(n=s[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){r=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(s[e]=n[0]),void 0!==s.removeListener&&this.emit("removeListener",e,r||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,s;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(s=0;s<o.length;++s)"removeListener"!==(i=o[s])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},o.prototype.listeners=function(e){return u(this,e,!0)},o.prototype.rawListeners=function(e){return u(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}},t={};function n(s){var i=t[s];if(void 0!==i)return i.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var s={};return(()=>{n.d(s,{default:()=>ce});var e=n(928),t=n.n(e);const i="UI_EVENT",o="iframe-loaded",r="iframe-call",a="iframe-log",c="popup-bootstrap",h="popup-loaded",d="popup-core-loaded",l="popup-init",u="popup-error",p="open-usb-permissions",m="popup-handshake",g="popup-closed",f="ui-cancel-popup-request",v="window.close",y={Init_NotInitialized:"TrezorConnect not initialized",Init_AlreadyInitialized:"TrezorConnect has been already initialized",Init_IframeBlocked:"Iframe blocked",Init_IframeTimeout:"Iframe timeout",Init_ManifestMissing:"Manifest not set. Read more at https://github.com/trezor/trezor-suite/blob/develop/docs/packages/connect/index.md",Popup_ConnectionMissing:"Unable to establish connection with iframe",Transport_Missing:"Transport is missing",Transport_InvalidProtobuf:"",Method_InvalidPackage:"This package is not suitable to work with browser. Use @trezor/connect-web package instead",Method_InvalidParameter:"",Method_NotAllowed:"Method not allowed for this configuration",Method_PermissionsNotGranted:"Permissions not granted",Method_Cancel:"Cancelled",Method_Interrupted:"Popup closed",Method_UnknownCoin:"Coin not found",Method_AddressNotMatch:"Addresses do not match",Method_FirmwareUpdate_DownloadFailed:"Failed to download firmware binary",Method_Discovery_BundleException:"",Method_Override:"override",Method_NoResponse:"Call resolved without response",Backend_NotSupported:"BlockchainLink settings not found in coins.json",Backend_WorkerMissing:"",Backend_Disconnected:"Backend disconnected",Backend_Invalid:"Invalid backend",Backend_Error:"",Runtime:"",Device_NotFound:"Device not found",Device_InitializeFailed:"",Device_FwException:"",Device_ModeException:"",Device_Disconnected:"Device disconnected",Device_UsedElsewhere:"Device is used in another window",Device_InvalidState:"Passphrase is incorrect",Device_CallInProgress:"Device call in progress"};class b extends Error{constructor(e,t){super(t),this.code=e,this.message=t}}const w=(e,t)=>new b(e,t||y[e]),_=e=>({success:!1,payload:{error:e.message,code:e.code}}),E={TRANSPORT:"ui-no_transport",BOOTLOADER:"ui-device_bootloader_mode",NOT_IN_BOOTLOADER:"ui-device_not_in_bootloader_mode",REQUIRE_MODE:"ui-device_require_mode",INITIALIZE:"ui-device_not_initialized",SEEDLESS:"ui-device_seedless",FIRMWARE_OLD:"ui-device_firmware_old",FIRMWARE_OUTDATED:"ui-device_firmware_outdated",FIRMWARE_NOT_SUPPORTED:"ui-device_firmware_unsupported",FIRMWARE_NOT_COMPATIBLE:"ui-device_firmware_not_compatible",FIRMWARE_NOT_INSTALLED:"ui-device_firmware_not_installed",FIRMWARE_PROGRESS:"ui-firmware-progress",DEVICE_NEEDS_BACKUP:"ui-device_needs_backup",REQUEST_UI_WINDOW:"ui-request_window",CLOSE_UI_WINDOW:"ui-close_window",REQUEST_PERMISSION:"ui-request_permission",REQUEST_CONFIRMATION:"ui-request_confirmation",REQUEST_PIN:"ui-request_pin",INVALID_PIN:"ui-invalid_pin",REQUEST_PASSPHRASE:"ui-request_passphrase",REQUEST_PASSPHRASE_ON_DEVICE:"ui-request_passphrase_on_device",INVALID_PASSPHRASE:"ui-invalid_passphrase",CONNECT:"ui-connect",LOADING:"ui-loading",SET_OPERATION:"ui-set_operation",SELECT_DEVICE:"ui-select_device",SELECT_ACCOUNT:"ui-select_account",SELECT_FEE:"ui-select_fee",UPDATE_CUSTOM_FEE:"ui-update_custom_fee",INSUFFICIENT_FUNDS:"ui-insufficient_funds",REQUEST_BUTTON:"ui-button",REQUEST_WORD:"ui-request_word",LOGIN_CHALLENGE_REQUEST:"ui-login_challenge_request",BUNDLE_PROGRESS:"ui-bundle_progress",ADDRESS_VALIDATION:"ui-address_validation",IFRAME_FAILURE:"ui-iframe_failure",RECEIVE_PERMISSION:"ui-receive_permission",RECEIVE_CONFIRMATION:"ui-receive_confirmation",RECEIVE_PIN:"ui-receive_pin",RECEIVE_PASSPHRASE:"ui-receive_passphrase",RECEIVE_DEVICE:"ui-receive_device",RECEIVE_ACCOUNT:"ui-receive_account",RECEIVE_FEE:"ui-receive_fee",RECEIVE_WORD:"ui-receive_word",INVALID_PASSPHRASE_ACTION:"ui-invalid_passphrase_action",CHANGE_SETTINGS:"ui-change_settings",LOGIN_CHALLENGE_RESPONSE:"ui-login_challenge_response"};class L{css="";MAX_ENTRIES=100;constructor(e,t,n){this.prefix=e,this.enabled=t,this.messages=[],n&&(this.logWriter=n)}setColors(e){this.css="undefined"!=typeof window&&e[this.prefix]?e[this.prefix]:""}addMessage({level:e,prefix:t,timestamp:n},...s){const i={level:e,prefix:t,css:this.css,message:s,timestamp:n||Date.now()};if(this.messages.push(i),this.logWriter)try{this.logWriter.add(i)}catch(e){console.error("There was an error adding log message",e,i)}this.messages.length>this.MAX_ENTRIES&&this.messages.shift()}setWriter(e){this.logWriter=e}log(...e){this.addMessage({level:"log",prefix:this.prefix},...e),this.enabled&&(this.prefix,this.css)}error(...e){this.addMessage({level:"error",prefix:this.prefix},...e),this.enabled&&console.error(`%c${this.prefix}`,this.css,...e)}info(...e){this.addMessage({level:"info",prefix:this.prefix},...e),this.enabled&&console.info(`%c${this.prefix}`,this.css,...e)}warn(...e){this.addMessage({level:"warn",prefix:this.prefix},...e),this.enabled&&console.warn(`%c${this.prefix}`,this.css,...e)}debug(...e){this.addMessage({level:"debug",prefix:this.prefix},...e),this.enabled&&(this.css?(this.prefix,this.css):this.prefix)}getLog(){return this.messages}}const I="#bada55",S="#20abd8",T="#f4a744",P={"@trezor/connect":`color: ${S}; background: #000;`,"@trezor/connect-web":`color: ${S}; background: #000;`,"@trezor/connect-webextension":`color: ${S}; background: #000;`,IFrame:`color: ${T}; background: #000;`,Core:`color: ${T}; background: #000;`,DeviceList:`color: ${I}; background: #000;`,Device:`color: ${I}; background: #000;`,DeviceCommands:`color: ${I}; background: #000;`,"@trezor/transport":`color: ${I}; background: #000;`,InteractionTimeout:`color: ${I}; background: #000;`,"@trezor/connect-popup":"color: #fbd948; background: #000;"},k=new class{logs={};colors={};constructor({colors:e}){this.colors=e}initLog(e,t,n){const s=n||this.writer,i=new L(e,!!t,s);return this.colors&&i.setColors(this.colors),this.logs[e]=i,i}setLogWriter(e){Object.keys(this.logs).forEach((t=>{if(this.writer=e(),this.writer){this.logs[t].setWriter(this.writer);const{messages:e}=this.logs[t];e.forEach((e=>{this.writer?.add(e)}))}}))}enableLog(e){Object.keys(this.logs).forEach((t=>{this.logs[t].enabled=!!e}))}enableLogByPrefix(e,t){this.logs[e]&&(this.logs[e].enabled=t)}getLog(){let e=[];return Object.keys(this.logs).forEach((t=>{e=e.concat(this.logs[t].messages)})),e.sort(((e,t)=>e.timestamp-t.timestamp)),e}}({colors:P}),C=k.initLog.bind(k),M=k.setLogWriter.bind(k);k.enableLog.bind(k),k.enableLogByPrefix.bind(k),k.getLog.bind(k);class x extends e.EventEmitter{listenerCount(e){return super.listenerCount(e)}}const A="storage_v2";let O={origin:{}};const R=()=>{const e=localStorage.getItem(A);return e?JSON.parse(e):{origin:{}}};new class extends x{save(e,t=!1){if(!t&&n.g.window)try{const t=e(R());localStorage.setItem(A,JSON.stringify(t)),this.emit("changed",t)}catch(t){console.warn("long term storage not available"),O=e(O)}else O=e(O)}saveForOrigin(e,t,n=!1){this.save((n=>({...n,origin:{...n.origin,[t]:e(n.origin?.[t]||{})}})),n)}load(e=!1){if(e||!n.g?.window?.localStorage)return O;try{return R()}catch(e){return console.warn("long term storage not available"),O}}loadForOrigin(e,t=!1){const n=this.load(t);return n.origin?.[e]||{}}};const D=e=>{let t=()=>{},n=()=>{};const s=new Promise(((e,s)=>{t=e,n=s}));return{id:e,resolve:t,reject:n,promise:s}},z=e=>Array.isArray(e),F=()=>new Error("Aborted by signal"),N=()=>new Error("Aborted by deadline"),W=()=>new Error("Aborted by timeout"),j=(e,t)=>new Promise(((n,s)=>{if(t.aborted)return s();if(void 0===e)return n();const i=setTimeout(n,e),o=()=>{clearTimeout(i),t.removeEventListener("abort",o),s()};t.addEventListener("abort",o)})),U=(e,t,n)=>new Promise(((s,i)=>{if(n.aborted)return i();const o=void 0!==e?setTimeout((()=>i(t())),e):void 0,r=()=>{clearTimeout(o),n.removeEventListener("abort",r),i()};n.addEventListener("abort",r)})),G=(e,t)=>new Promise(((n,s)=>{if(t.aborted)return s();if(e?.aborted)return s(F());const i=()=>s(F());e?.addEventListener("abort",i);const o=()=>{e?.removeEventListener("abort",i),t.removeEventListener("abort",o),s()};t.addEventListener("abort",o)})),H=async(e,t)=>{const n=new AbortController,s=()=>n.abort();t.aborted&&s(),t.addEventListener("abort",s);try{return await new Promise((t=>t(e(n.signal))))}finally{t.removeEventListener("abort",s)}},B=async(e,t)=>{const{signal:n,delay:s,attempts:i,timeout:o,deadline:r,gap:a}=t,c=r&&r-Date.now(),h=z(i)?i.length:i??(r?1/0:1),d=new AbortController,l=d.signal,u=z(i)?e=>i[e]:()=>({timeout:o,gap:a});try{return await Promise.race([G(n,l),U(c,N,l),j(s,l).then((()=>(async(e,t,n,s)=>{for(let i=0;i<e-1&&!s.aborted;i++){const e=new AbortController,o=()=>e.abort();s.addEventListener("abort",o);try{return await t(i,e.signal)}catch{o(),await n(i)}finally{s.removeEventListener("abort",o)}}return s.aborted?Promise.reject():t(e-1,s)})(h,((t,n)=>Promise.race([U(u(t).timeout,W,l),H(e,n)])),(e=>j(u(e).gap??0,l)),l)))])}finally{d.abort()}};class V extends x{messagePromises={};messagesQueue=[];messageID=0;isConnected=!1;handshakeMaxRetries=5;handshakeRetryInterval=2e3;constructor({sendFn:e,channel:t,logger:n,lazyHandshake:s=!1,legacyMode:i=!1}){super(),this.channel=t,this.sendFn=e,this.lazyHandshake=s,this.legacyMode=i,this.logger=n}init(){return this.handshakeFinished||(this.handshakeFinished=D(),this.legacyMode&&setTimeout((()=>{this.handshakeFinished?.resolve()}),500),this.lazyHandshake||this.handshakeWithPeer()),this.handshakeFinished.promise}handshakeWithPeer(){return this.logger?.log(this.channel.here,"handshake"),B((async()=>{this.postMessage({type:"channel-handshake-request",data:{success:!0,payload:void 0}},{usePromise:!1,useQueue:!1}),await(this.handshakeFinished?.promise)}),{attempts:this.handshakeMaxRetries,timeout:this.handshakeRetryInterval}).then((()=>{this.logger?.log(this.channel.here,"handshake confirmed"),this.messagesQueue.forEach((e=>{e.channel=this.channel,this.sendFn(e)})),this.messagesQueue=[]})).catch((()=>{this.handshakeFinished?.reject(new Error("handshake failed")),this.handshakeFinished=void 0}))}onMessage(e){let t=e;this.legacyMode&&void 0===t.type&&"data"in t&&"object"==typeof t.data&&null!==t.data&&"type"in t.data&&"string"==typeof t.data.type&&(t=t.data);const{channel:n,id:s,type:i,payload:o,success:r}=t;if(!this.legacyMode){if(!n?.peer||n.peer!==this.channel.here)return;if(!n?.here||this.channel.peer!==n.here)return}if("channel-handshake-request"===i)return this.postMessage({type:"channel-handshake-confirm",data:{success:!0,payload:void 0}},{usePromise:!1,useQueue:!1}),void(this.lazyHandshake&&this.handshakeWithPeer());if("channel-handshake-confirm"===i)return void this.handshakeFinished?.resolve(void 0);this.messagePromises[s]&&(this.messagePromises[s].resolve({id:s,payload:o,success:r}),delete this.messagePromises[s]);const a=Object.keys(this.messagePromises).length;a>5&&this.logger?.warn(`too many message promises (${a}). this feels unexpected!`),this.emit("message",t)}postMessage(e,{usePromise:t=!0,useQueue:n=!0}={}){if(e.channel=this.channel,t){this.messageID++,e.id=this.messageID,this.messagePromises[e.id]=D();try{this.sendFn(e)}catch(t){n&&this.messagesQueue.push(e)}return this.messagePromises[e.id].promise}try{this.sendFn(e)}catch(t){n&&this.messagesQueue.push(e)}}resolveMessagePromises(e){Object.keys(this.messagePromises).forEach((t=>this.messagePromises[t].resolve({id:t,payload:e})))}clear(){this.handshakeFinished=void 0}}class q extends V{constructor({name:e,channel:t,logger:n,lazyHandshake:s,legacyMode:i,allowSelfOrigin:o=!1,currentId:r}){super({channel:t,sendFn:e=>{if(!this.port)throw new Error("port not assigned");this.port.postMessage(e)},logger:n,lazyHandshake:s,legacyMode:i}),this.name=e,this.allowSelfOrigin=o,this.currentId=r,this.connect()}connect(){chrome.runtime.onConnect.addListener((e=>{e.name===this.name&&(this.currentId?.()&&this.currentId?.()!==e.sender?.tab?.id||(this.port=e,this.port.onMessage.addListener(((e,{sender:t})=>{if(!t)return void this.logger?.error("service-worker-window","no sender");const{origin:n}=t,s=["https://connect.trezor.io","https://staging-connect.trezor.io","https://suite.corp.sldev.cz","https://dev.suite.sldev.cz","http://localhost:8088"],i=chrome?.runtime?.id;i&&s.push(`chrome-extension://${i}`),n?s.includes(n)?(n!==self.origin||this.allowSelfOrigin)&&this.onMessage(e):this.logger?.error("connect-webextension/messageChannel/extensionPort/onMessage","origin not whitelisted",n):this.logger?.error("connect-webextension/messageChannel/extensionPort/onMessage","no origin")}))))})),this.isConnected=!0}disconnect(){this.isConnected&&(this.port?.disconnect(),this.clear(),this.isConnected=!1)}}const Q="TrezorConnectInteractionLayer",$=`\n    <div class="trezorconnect-container" id="${Q}">\n        <div class="trezorconnect-window">\n            <div class="trezorconnect-head">\n                <svg class="trezorconnect-logo" x="0px" y="0px" viewBox="0 0 163.7 41.9" width="78px" height="20px" preserveAspectRatio="xMinYMin meet">\n                    <polygon points="101.1,12.8 118.2,12.8 118.2,17.3 108.9,29.9 118.2,29.9 118.2,35.2 101.1,35.2 101.1,30.7 110.4,18.1 101.1,18.1"/>\n                    <path d="M158.8,26.9c2.1-0.8,4.3-2.9,4.3-6.6c0-4.5-3.1-7.4-7.7-7.4h-10.5v22.3h5.8v-7.5h2.2l4.1,7.5h6.7L158.8,26.9z M154.7,22.5 h-4V18h4c1.5,0,2.5,0.9,2.5,2.2C157.2,21.6,156.2,22.5,154.7,22.5z"/>\n                    <path d="M130.8,12.5c-6.8,0-11.6,4.9-11.6,11.5s4.9,11.5,11.6,11.5s11.7-4.9,11.7-11.5S137.6,12.5,130.8,12.5z M130.8,30.3 c-3.4,0-5.7-2.6-5.7-6.3c0-3.8,2.3-6.3,5.7-6.3c3.4,0,5.8,2.6,5.8,6.3C136.6,27.7,134.2,30.3,130.8,30.3z"/>\n                    <polygon points="82.1,12.8 98.3,12.8 98.3,18 87.9,18 87.9,21.3 98,21.3 98,26.4 87.9,26.4 87.9,30 98.3,30 98.3,35.2 82.1,35.2 "/>\n                    <path d="M24.6,9.7C24.6,4.4,20,0,14.4,0S4.2,4.4,4.2,9.7v3.1H0v22.3h0l14.4,6.7l14.4-6.7h0V12.9h-4.2V9.7z M9.4,9.7 c0-2.5,2.2-4.5,5-4.5s5,2,5,4.5v3.1H9.4V9.7z M23,31.5l-8.6,4l-8.6-4V18.1H23V31.5z"/>\n                    <path d="M79.4,20.3c0-4.5-3.1-7.4-7.7-7.4H61.2v22.3H67v-7.5h2.2l4.1,7.5H80l-4.9-8.3C77.2,26.1,79.4,24,79.4,20.3z M71,22.5h-4V18 h4c1.5,0,2.5,0.9,2.5,2.2C73.5,21.6,72.5,22.5,71,22.5z"/>\n                    <polygon points="40.5,12.8 58.6,12.8 58.6,18.1 52.4,18.1 52.4,35.2 46.6,35.2 46.6,18.1 40.5,18.1 "/>\n                </svg>\n                <div class="trezorconnect-close">\n                    <svg x="0px" y="0px" viewBox="24 24 60 60" width="24px" height="24px" preserveAspectRatio="xMinYMin meet">\n                        <polygon class="st0" points="40,67.9 42.1,70 55,57.1 67.9,70 70,67.9 57.1,55 70,42.1 67.9,40 55,52.9 42.1,40 40,42.1 52.9,55 "/>\n                    </svg>\n                </div>\n            </div>\n            <div class="trezorconnect-body">\n                <h3>Popup was blocked</h3>\n                <p>Please click to "Continue" to open popup manually</p>\n                <button class="trezorconnect-open">Continue</button>\n            </div>\n        </div>\n    </div>\n`,K=(e,t)=>{if(document.getElementById(Q))return;const n=document.createElement("div");n.id=Q,n.className="trezorconnect-container",n.innerHTML=$,document.body&&document.body.appendChild(n);n.getElementsByClassName("trezorconnect-open")[0].onclick=()=>{e(),document.body&&document.body.removeChild(n)};n.getElementsByClassName("trezorconnect-close")[0].onclick=()=>{t(),document.body&&document.body.removeChild(n)}};class J extends V{constructor({windowHere:e,windowPeer:t,channel:n,logger:s,origin:i}){super({channel:n,sendFn:e=>{t()?.postMessage(e,i)},logger:s}),this._listener=this.listener.bind(this),this._windowHere=e,this.connect()}listener(e){const t={...e.data,success:!0,origin:e.origin,payload:e.data.payload||{},channel:e.data.channel||{peer:this.channel.here,here:this.channel.peer}};this.onMessage(t)}connect(){this._windowHere.addEventListener("message",this._listener),this.isConnected=!0}disconnect(){this.isConnected&&(this._windowHere.removeEventListener("message",this._listener),this.isConnected=!1)}}class Z extends(t()){locked=!1;extensionTabId=0;constructor(e,{logger:t}){super(),this.settings=e,this.origin=(e=>{if("string"!=typeof e)return"unknown";if(0===e.indexOf("file://"))return"file://";const[t]=e.match(/^https?:\/\/[^/]+/)??[];return t??"unknown"})(e.popupSrc),this.logger=t,"webextension"===this.settings.env?this.channel=new q({name:"trezor-connect",channel:{here:"@trezor/connect-webextension",peer:"@trezor/connect-content-script"},logger:t,currentId:()=>{if("tab"===this.popupWindow?.mode)return this.popupWindow?.tab.id},legacyMode:!this.settings.useCoreInPopup}):this.channel=new J({windowHere:window,windowPeer:()=>{if("window"===this.popupWindow?.mode)return this.popupWindow?.window},channel:{here:"@trezor/connect-web",peer:"@trezor/connect-popup"},logger:t,origin:this.origin}),this.settings.useCoreInPopup||(this.iframeHandshakePromise=D(o),this.channelIframe=new J({windowHere:window,windowPeer:()=>window,channel:{here:"@trezor/connect-web",peer:"@trezor/connect-iframe"},logger:t,origin:this.origin}),this.channelIframe?.on("message",this.handleMessage.bind(this))),this.settings.useCoreInPopup?(this.handshakePromise=D(),this.channel.on("message",this.handleCoreMessage.bind(this))):"webextension"===this.settings.env?this.channel.on("message",this.handleExtensionMessage.bind(this)):this.channel.on("message",this.handleMessage.bind(this)),this.channel.init()}async request(){if(this.settings.useCoreInPopup&&"tab"===this.popupWindow?.mode){await(e=this.popupWindow?.tab?.id,new Promise((t=>{if(!e)return t(!1);chrome.tabs.get(e,(function(){chrome.runtime.lastError?t(!1):t(!0)}))})))||this.clear()}var e;if(this.locked)return void("tab"===this.popupWindow?.mode&&this.popupWindow.tab.id?chrome.tabs.update(this.popupWindow.tab.id,{active:!0}):"window"===this.popupWindow?.mode&&this.popupWindow.window.focus());this.popupWindow&&!this.locked&&this.close();const t=this.open.bind(this);this.locked=!0;const n="webextension"===this.settings.env?1:850;this.requestTimeout=setTimeout((()=>{this.requestTimeout=void 0,t()}),n)}unlock(){this.locked=!1}open(){const e=this.settings.popupSrc;this.settings.useCoreInPopup?this.openWrapper(e):(this.popupPromise=D(h),this.openWrapper(e),this.closeInterval=setInterval((()=>{this.popupWindow&&("tab"===this.popupWindow.mode&&this.popupWindow.tab.id?chrome.tabs.get(this.popupWindow.tab.id,(e=>{e||(this.emit(g),this.clear())})):"window"===this.popupWindow.mode&&this.popupWindow.window.closed&&(this.clear(),this.emit(g)))}),500),this.openTimeout=setTimeout((()=>{this.clear(),K(this.open.bind(this),(()=>{this.emit(g)}))}),3e3))}openWrapper(e){if("webextension"===this.settings.env)chrome.windows.getCurrent((t=>{this.logger.debug("opening popup. currentWindow: ",t),"normal"!==t.type?chrome.windows.create({url:e},(e=>{chrome.tabs.query({windowId:e?.id,active:!0},(e=>{this.popupWindow={mode:"tab",tab:e[0]},this.injectContentScript(e[0].id)}))})):chrome.tabs.query({currentWindow:!0,active:!0},(t=>{this.extensionTabId=t[0].id,chrome.tabs.create({url:e,index:t[0].index+1},(e=>{this.popupWindow={mode:"tab",tab:e},this.injectContentScript(e.id)}))}))}));else{const t=window.open(e,"modal");if(!t)return;this.popupWindow={mode:"window",window:t}}this.channel.isConnected||this.channel.connect()}injectContentScript=e=>{chrome.permissions.getAll((t=>{t.permissions?.includes("scripting")&&chrome.scripting.executeScript({target:{tabId:e},func:()=>{(()=>{var e={928:e=>{var t,n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,s){function i(n){e.removeListener(t,o),s(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&g(e,"error",t,n)}(e,i,{once:!0})}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var r=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function h(e,t,n,s){var i,o,r,h;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),r=o[t]),void 0===r)r=o[t]=n,++e._eventsCount;else if("function"==typeof r?r=o[t]=s?[n,r]:[r,n]:s?r.unshift(n):r.push(n),(i=c(e))>0&&r.length>i&&!r.warned){r.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=r.length,h=d,console&&console.warn&&console.warn(h)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,n){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=d.bind(s);return i.listener=n,s.wrapFn=i,i}function u(e,t,n){var s=e._events;if(void 0===s)return[];var i=s[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):m(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),s=0;s<t;++s)n[s]=e[s];return n}function g(e,t,n,s){if("function"==typeof e.on)s.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){s.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return r},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");r=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var r;if(t.length>0&&(r=t[0]),r instanceof Error)throw r;var a=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw a.context=r,a}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)s(c,this,t);else{var h=c.length,d=m(c,h);for(n=0;n<h;++n)s(d[n],this,t)}return!0},o.prototype.addListener=function(e,t){return h(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return h(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,l(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,l(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,s,i,o,r;if(a(t),void 0===(s=this._events))return this;if(void 0===(n=s[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){r=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(s[e]=n[0]),void 0!==s.removeListener&&this.emit("removeListener",e,r||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,s;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(s=0;s<o.length;++s)"removeListener"!==(i=o[s])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},o.prototype.listeners=function(e){return u(this,e,!0)},o.prototype.rawListeners=function(e){return u(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}},t={};function n(s){var i=t[s];if(void 0!==i)return i.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,n),o.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var e=n(928);class t extends e.EventEmitter{listenerCount(e){return super.listenerCount(e)}}const s="storage_v2";let i={origin:{}};const o=()=>{const e=localStorage.getItem(s);return e?JSON.parse(e):{origin:{}}};new class extends t{save(e,t=!1){if(!t&&n.g.window)try{const t=e(o());localStorage.setItem(s,JSON.stringify(t)),this.emit("changed",t)}catch(t){console.warn("long term storage not available"),i=e(i)}else i=e(i)}saveForOrigin(e,t,n=!1){this.save((n=>({...n,origin:{...n.origin,[t]:e(n.origin?.[t]||{})}})),n)}load(e=!1){if(e||!n.g?.window?.localStorage)return i;try{return o()}catch(e){return console.warn("long term storage not available"),i}}loadForOrigin(e,t=!1){const n=this.load(t);return n.origin?.[e]||{}}};const r=e=>{let t=()=>{},n=()=>{};const s=new Promise(((e,s)=>{t=e,n=s}));return{id:e,resolve:t,reject:n,promise:s}},a=e=>Array.isArray(e),c=()=>new Error("Aborted by signal"),h=()=>new Error("Aborted by deadline"),d=()=>new Error("Aborted by timeout"),l=(e,t)=>new Promise(((n,s)=>{if(t.aborted)return s();if(void 0===e)return n();const i=setTimeout(n,e),o=()=>{clearTimeout(i),t.removeEventListener("abort",o),s()};t.addEventListener("abort",o)})),u=(e,t,n)=>new Promise(((s,i)=>{if(n.aborted)return i();const o=void 0!==e?setTimeout((()=>i(t())),e):void 0,r=()=>{clearTimeout(o),n.removeEventListener("abort",r),i()};n.addEventListener("abort",r)})),p=(e,t)=>new Promise(((n,s)=>{if(t.aborted)return s();if(e?.aborted)return s(c());const i=()=>s(c());e?.addEventListener("abort",i);const o=()=>{e?.removeEventListener("abort",i),t.removeEventListener("abort",o),s()};t.addEventListener("abort",o)})),m=async(e,t)=>{const n=new AbortController,s=()=>n.abort();t.aborted&&s(),t.addEventListener("abort",s);try{return await new Promise((t=>t(e(n.signal))))}finally{t.removeEventListener("abort",s)}},g=async(e,t)=>{const{signal:n,delay:s,attempts:i,timeout:o,deadline:r,gap:c}=t,g=r&&r-Date.now(),f=a(i)?i.length:i??(r?1/0:1),v=new AbortController,y=v.signal,b=a(i)?e=>i[e]:()=>({timeout:o,gap:c});try{return await Promise.race([p(n,y),u(g,h,y),l(s,y).then((()=>(async(e,t,n,s)=>{for(let i=0;i<e-1&&!s.aborted;i++){const e=new AbortController,o=()=>e.abort();s.addEventListener("abort",o);try{return await t(i,e.signal)}catch{o(),await n(i)}finally{s.removeEventListener("abort",o)}}return s.aborted?Promise.reject():t(e-1,s)})(f,((t,n)=>Promise.race([u(b(t).timeout,d,y),m(e,n)])),(e=>l(b(e).gap??0,y)),y)))])}finally{v.abort()}};class f extends t{messagePromises={};messagesQueue=[];messageID=0;isConnected=!1;handshakeMaxRetries=5;handshakeRetryInterval=2e3;constructor({sendFn:e,channel:t,logger:n,lazyHandshake:s=!1,legacyMode:i=!1}){super(),this.channel=t,this.sendFn=e,this.lazyHandshake=s,this.legacyMode=i,this.logger=n}init(){return this.handshakeFinished||(this.handshakeFinished=r(),this.legacyMode&&setTimeout((()=>{this.handshakeFinished?.resolve()}),500),this.lazyHandshake||this.handshakeWithPeer()),this.handshakeFinished.promise}handshakeWithPeer(){return this.logger?.log(this.channel.here,"handshake"),g((async()=>{this.postMessage({type:"channel-handshake-request",data:{success:!0,payload:void 0}},{usePromise:!1,useQueue:!1}),await(this.handshakeFinished?.promise)}),{attempts:this.handshakeMaxRetries,timeout:this.handshakeRetryInterval}).then((()=>{this.logger?.log(this.channel.here,"handshake confirmed"),this.messagesQueue.forEach((e=>{e.channel=this.channel,this.sendFn(e)})),this.messagesQueue=[]})).catch((()=>{this.handshakeFinished?.reject(new Error("handshake failed")),this.handshakeFinished=void 0}))}onMessage(e){let t=e;this.legacyMode&&void 0===t.type&&"data"in t&&"object"==typeof t.data&&null!==t.data&&"type"in t.data&&"string"==typeof t.data.type&&(t=t.data);const{channel:n,id:s,type:i,payload:o,success:r}=t;if(!this.legacyMode){if(!n?.peer||n.peer!==this.channel.here)return;if(!n?.here||this.channel.peer!==n.here)return}if("channel-handshake-request"===i)return this.postMessage({type:"channel-handshake-confirm",data:{success:!0,payload:void 0}},{usePromise:!1,useQueue:!1}),void(this.lazyHandshake&&this.handshakeWithPeer());if("channel-handshake-confirm"===i)return void this.handshakeFinished?.resolve(void 0);this.messagePromises[s]&&(this.messagePromises[s].resolve({id:s,payload:o,success:r}),delete this.messagePromises[s]);const a=Object.keys(this.messagePromises).length;a>5&&this.logger?.warn(`too many message promises (${a}). this feels unexpected!`),this.emit("message",t)}postMessage(e,{usePromise:t=!0,useQueue:n=!0}={}){if(e.channel=this.channel,t){this.messageID++,e.id=this.messageID,this.messagePromises[e.id]=r();try{this.sendFn(e)}catch(t){n&&this.messagesQueue.push(e)}return this.messagePromises[e.id].promise}try{this.sendFn(e)}catch(t){n&&this.messagesQueue.push(e)}}resolveMessagePromises(e){Object.keys(this.messagePromises).forEach((t=>this.messagePromises[t].resolve({id:t,payload:e})))}clear(){this.handshakeFinished=void 0}}const v=new class extends f{constructor({name:e,channel:t}){super({channel:t,sendFn:e=>{if(!this.port)throw new Error("port not assigned");this.port.postMessage(e)}});const n=chrome.runtime.connect({name:e});this.port=n,this.connect()}connect(){this.port?.onMessage.addListener((e=>{e.channel.here!==this.channel.here&&this.onMessage(e)})),this.isConnected=!0}disconnect(){this.isConnected&&(this.port?.disconnect(),this.isConnected=!1)}}({name:"trezor-connect",channel:{here:"@trezor/connect-content-script",peer:"@trezor/connect-webextension"}});v.init().then((()=>{window.postMessage({type:"popup-content-script-loaded",payload:{...chrome.runtime.getManifest(),id:chrome.runtime.id}},window.location.origin),v.on("message",(e=>{window.postMessage(e,window.location.origin)})),window.addEventListener("message",(e=>{"@trezor/connect-webextension"!==e.data?.channel?.here&&"popup-content-script-loaded"!==e.data?.type&&e.source===window&&e.data&&v.postMessage(e.data,{usePromise:!1})})),window.addEventListener("beforeunload",(()=>{window.postMessage({type:"popup-closed"},window.location.origin)}))}))})()})()}}).then((()=>this.logger.debug("content script injected"))).catch((e=>this.logger.error("content script injection error",e)))}))};handleCoreMessage(e){e.type===d?(this.channel.postMessage({type:m,payload:{settings:this.settings}}),this.handshakePromise?.resolve()):e.type===g&&this.channel.resolveMessagePromises({code:"Method_Interrupted",error:g})}handleExtensionMessage(e){e.type===u||e.type===h||e.type===c?this.handleMessage(e):e.type===p?chrome.tabs.query({currentWindow:!0,active:!0},(e=>{chrome.tabs.create({url:"trezor-usb-permissions.html",index:e[0].index+1},(e=>{}))})):e.type===v&&this.clear()}handleMessage(e){if(e.type===o)this.iframeHandshakePromise?.resolve(e.payload);else if(e.type===c)this.openTimeout&&clearTimeout(this.openTimeout);else if(e.type===u&&this.popupWindow){const t=e.payload&&"string"==typeof e.payload.error?e.payload.error:null;this.emit(g,t?`Popup error: ${t}`:null),this.clear()}else e.type===h?(this.openTimeout&&clearTimeout(this.openTimeout),this.popupPromise&&this.popupPromise.resolve(),this.iframeHandshakePromise?.promise.then((e=>{this.channel.postMessage({type:l,payload:{...e,settings:this.settings}})}))):e.type!==f&&e.type!==E.CLOSE_UI_WINDOW||this.clear(!1)}clear(e=!0){this.locked=!1,this.popupPromise=void 0,this.handshakePromise=D(),this.channel&&this.channel.disconnect(),this.requestTimeout&&(clearTimeout(this.requestTimeout),this.requestTimeout=void 0),this.openTimeout&&(clearTimeout(this.openTimeout),this.openTimeout=void 0),this.closeInterval&&(clearInterval(this.closeInterval),this.closeInterval=void 0),e&&this.extensionTabId&&(chrome.tabs.update(this.extensionTabId,{active:!0}),this.extensionTabId=0)}close(){if(this.popupWindow){if(this.logger.debug("closing popup"),"tab"===this.popupWindow.mode){let e=chrome.runtime.lastError;this.popupWindow.tab.id&&chrome.tabs.remove(this.popupWindow.tab.id,(()=>{e=chrome.runtime.lastError,e&&this.logger.error("closed with error",e)}))}else"window"===this.popupWindow.mode&&this.popupWindow.window.close();this.popupWindow=void 0}}async postMessage(e){if(!this.popupWindow&&e.type!==E.REQUEST_UI_WINDOW&&this.openTimeout)return this.clear(),void K(this.open.bind(this),(()=>{this.emit(g)}));this.popupPromise&&await this.popupPromise.promise,"window"===this.popupWindow?.mode?this.popupWindow.window.postMessage(e,this.origin):"tab"===this.popupWindow?.mode&&this.channel.postMessage(e)}}const X="9.2.2",Y=`https://connect.trezor.io/${X.split(".").map((e=>parseInt(e,10)))[0]}/`,ee={configSrc:"./data/config.json",version:X,debug:!1,priority:2,trustedHost:!0,connectSrc:Y,iframeSrc:`${Y}iframe.html`,popup:!1,popupSrc:`${Y}popup.html`,webusbSrc:`${Y}webusb.html`,transports:void 0,pendingTransportEvent:!0,env:"node",lazyLoad:!1,timestamp:(new Date).getTime(),interactionTimeout:600,sharedLogger:!0},te=(e={})=>{const t={popup:!0,...e};return"string"!=typeof e.env&&(t.env="webextension"),((e={})=>{const t={...ee};"debug"in e&&("boolean"==typeof e.debug?t.debug=e.debug:"string"==typeof e.debug&&(t.debug="true"===e.debug)),!1===e.trustedHost&&(t.trustedHost=e.trustedHost),"string"==typeof e.connectSrc&&e.connectSrc?.startsWith("http")?t.connectSrc=(e=>{if("string"==typeof e)return e.match(/^https:\/\/([A-Za-z0-9\-_]+\.)*trezor\.io\//)||e.match(/^https?:\/\/localhost:[58][0-9]{3}\//)||e.match(/^https:\/\/([A-Za-z0-9\-_]+\.)*sldev\.cz\//)||e.match(/^https?:\/\/([A-Za-z0-9\-_]+\.)*trezoriovpjcahpzkrewelclulmszwbqpzmzgub37gbcjlvluxtruqad\.onion\//)?e:void 0})(e.connectSrc):t.trustedHost&&(t.connectSrc=e.connectSrc);const n=t.connectSrc||Y;return t.iframeSrc=`${n}iframe.html`,t.popupSrc=`${n}popup.html`,t.webusbSrc=`${n}webusb.html`,"boolean"==typeof e.transportReconnect&&(t.transportReconnect=e.transportReconnect),"boolean"==typeof e.webusb&&(t.webusb=e.webusb),Array.isArray(e.transports)&&(t.transports=e.transports),"boolean"==typeof e.popup&&(t.popup=e.popup),"boolean"==typeof e.lazyLoad&&(t.lazyLoad=e.lazyLoad),"boolean"==typeof e.pendingTransportEvent&&(t.pendingTransportEvent=e.pendingTransportEvent),"string"==typeof e.extension&&(t.extension=e.extension),"string"==typeof e.env&&(t.env=e.env),"number"==typeof e.timestamp&&(t.timestamp=e.timestamp),"number"==typeof e.interactionTimeout&&(t.interactionTimeout=e.interactionTimeout),"object"==typeof e.manifest&&(t.manifest=(e=>{if(e&&"string"==typeof e.email&&"string"==typeof e.appUrl)return{email:e.email,appUrl:e.appUrl}})(e.manifest)),"boolean"==typeof e.sharedLogger&&(t.sharedLogger=e.sharedLogger),"boolean"==typeof e.useCoreInPopup&&(t.useCoreInPopup=e.useCoreInPopup),t})(t)},ne=new(t());let se=te();const ie=C("@trezor/connect-webextension"),oe=C("@trezor/connect-webextension/popupManager");let re;const ae=(({eventEmitter:e,manifest:t,init:n,call:s,requestLogin:i,uiResponse:o,renderWebUSBButton:r,disableWebUSB:a,requestWebUSBDevice:c,cancel:h,dispose:d})=>({manifest:t,init:n,getSettings:()=>s({method:"getSettings"}),on:(t,n)=>{e.on(t,n)},off:(t,n)=>{e.removeListener(t,n)},removeAllListeners:t=>{"string"==typeof t?e.removeAllListeners(t):e.removeAllListeners()},uiResponse:o,blockchainGetAccountBalanceHistory:e=>s({...e,method:"blockchainGetAccountBalanceHistory"}),blockchainGetCurrentFiatRates:e=>s({...e,method:"blockchainGetCurrentFiatRates"}),blockchainGetFiatRatesForTimestamps:e=>s({...e,method:"blockchainGetFiatRatesForTimestamps"}),blockchainDisconnect:e=>s({...e,method:"blockchainDisconnect"}),blockchainEstimateFee:e=>s({...e,method:"blockchainEstimateFee"}),blockchainGetTransactions:e=>s({...e,method:"blockchainGetTransactions"}),blockchainSetCustomBackend:e=>s({...e,method:"blockchainSetCustomBackend"}),blockchainSubscribe:e=>s({...e,method:"blockchainSubscribe"}),blockchainSubscribeFiatRates:e=>s({...e,method:"blockchainSubscribeFiatRates"}),blockchainUnsubscribe:e=>s({...e,method:"blockchainUnsubscribe"}),blockchainUnsubscribeFiatRates:e=>s({...e,method:"blockchainUnsubscribeFiatRates"}),requestLogin:e=>i(e),cardanoGetAddress:t=>s({...t,method:"cardanoGetAddress",useEventListener:e.listenerCount(E.ADDRESS_VALIDATION)>0}),cardanoGetNativeScriptHash:e=>s({...e,method:"cardanoGetNativeScriptHash"}),cardanoGetPublicKey:e=>s({...e,method:"cardanoGetPublicKey"}),cardanoSignTransaction:e=>s({...e,method:"cardanoSignTransaction"}),cardanoComposeTransaction:e=>s({...e,method:"cardanoComposeTransaction"}),cipherKeyValue:e=>s({...e,method:"cipherKeyValue"}),composeTransaction:e=>s({...e,method:"composeTransaction"}),ethereumGetAddress:t=>s({...t,method:"ethereumGetAddress",useEventListener:e.listenerCount(E.ADDRESS_VALIDATION)>0}),ethereumGetPublicKey:e=>s({...e,method:"ethereumGetPublicKey"}),ethereumSignMessage:e=>s({...e,method:"ethereumSignMessage"}),ethereumSignTransaction:e=>s({...e,method:"ethereumSignTransaction"}),ethereumSignTypedData:e=>s({...e,method:"ethereumSignTypedData"}),ethereumVerifyMessage:e=>s({...e,method:"ethereumVerifyMessage"}),getAccountDescriptor:e=>s({...e,method:"getAccountDescriptor"}),getAccountInfo:e=>s({...e,method:"getAccountInfo"}),getAddress:t=>s({...t,method:"getAddress",useEventListener:e.listenerCount(E.ADDRESS_VALIDATION)>0}),getDeviceState:e=>s({...e,method:"getDeviceState"}),getFeatures:e=>s({...e,method:"getFeatures"}),getFirmwareHash:e=>s({...e,method:"getFirmwareHash"}),getOwnershipId:e=>s({...e,method:"getOwnershipId"}),getOwnershipProof:e=>s({...e,method:"getOwnershipProof"}),getPublicKey:e=>s({...e,method:"getPublicKey"}),nemGetAddress:t=>s({...t,method:"nemGetAddress",useEventListener:e.listenerCount(E.ADDRESS_VALIDATION)>0}),nemSignTransaction:e=>s({...e,method:"nemSignTransaction"}),pushTransaction:e=>s({...e,method:"pushTransaction"}),rippleGetAddress:t=>s({...t,method:"rippleGetAddress",useEventListener:e.listenerCount(E.ADDRESS_VALIDATION)>0}),rippleSignTransaction:e=>s({...e,method:"rippleSignTransaction"}),signMessage:e=>s({...e,method:"signMessage"}),signTransaction:e=>s({...e,method:"signTransaction"}),solanaGetPublicKey:e=>s({...e,method:"solanaGetPublicKey"}),solanaGetAddress:e=>s({...e,method:"solanaGetAddress"}),solanaSignTransaction:e=>s({...e,method:"solanaSignTransaction"}),stellarGetAddress:t=>s({...t,method:"stellarGetAddress",useEventListener:e.listenerCount(E.ADDRESS_VALIDATION)>0}),stellarSignTransaction:e=>s({...e,method:"stellarSignTransaction"}),tezosGetAddress:t=>s({...t,method:"tezosGetAddress",useEventListener:e.listenerCount(E.ADDRESS_VALIDATION)>0}),tezosGetPublicKey:e=>s({...e,method:"tezosGetPublicKey"}),tezosSignTransaction:e=>s({...e,method:"tezosSignTransaction"}),unlockPath:e=>s({...e,method:"unlockPath"}),eosGetPublicKey:e=>s({...e,method:"eosGetPublicKey"}),eosSignTransaction:e=>s({...e,method:"eosSignTransaction"}),binanceGetAddress:t=>s({...t,method:"binanceGetAddress",useEventListener:e.listenerCount(E.ADDRESS_VALIDATION)>0}),binanceGetPublicKey:e=>s({...e,method:"binanceGetPublicKey"}),binanceSignTransaction:e=>s({...e,method:"binanceSignTransaction"}),verifyMessage:e=>s({...e,method:"verifyMessage"}),resetDevice:e=>s({...e,method:"resetDevice"}),wipeDevice:e=>s({...e,method:"wipeDevice"}),checkFirmwareAuthenticity:e=>s({...e,method:"checkFirmwareAuthenticity"}),applyFlags:e=>s({...e,method:"applyFlags"}),applySettings:e=>s({...e,method:"applySettings"}),authenticateDevice:e=>s({...e,method:"authenticateDevice"}),authorizeCoinjoin:e=>s({...e,method:"authorizeCoinjoin"}),cancelCoinjoinAuthorization:e=>s({...e,method:"cancelCoinjoinAuthorization"}),showDeviceTutorial:e=>s({...e,method:"showDeviceTutorial"}),backupDevice:e=>s({...e,method:"backupDevice"}),changeLanguage:e=>s({...e,method:"changeLanguage"}),changePin:e=>s({...e,method:"changePin"}),changeWipeCode:e=>s({...e,method:"changeWipeCode"}),firmwareUpdate:e=>s({...e,method:"firmwareUpdate"}),recoveryDevice:e=>s({...e,method:"recoveryDevice"}),getCoinInfo:e=>s({...e,method:"getCoinInfo"}),rebootToBootloader:e=>s({...e,method:"rebootToBootloader"}),setBusy:e=>s({...e,method:"setBusy"}),setProxy:e=>s({...e,method:"setProxy"}),dispose:d,cancel:h,renderWebUSBButton:r,disableWebUSB:a,requestWebUSBDevice:c}))({eventEmitter:ne,manifest:e=>{se=te({...se,manifest:e})},init:(e={})=>{const t=te({...se}),n=te({...se,...e});n.transports?.length||(n.transports=["BridgeTransport","WebUsbTransport"]),n.useCoreInPopup=!0;const s=JSON.stringify(t)===JSON.stringify(n);if(se=n,re&&s||(re&&re.close(),re=new Z(se,{logger:oe}),M((()=>{return e=re,{add:t=>{e.channel.postMessage({event:i,type:a,payload:t},{usePromise:!1,useQueue:!0})}};var e}))),ie.enabled=!!e.debug,!se.manifest)throw w("Init_ManifestMissing");return ie.debug("initiated"),Promise.resolve()},call:async e=>{ie.debug("call",e),se.popup&&await re.request(),await re.channel.init(),re.channel.postMessage({type:l,payload:{settings:se,useCore:!0}}),await(re.handshakePromise?.promise);try{const t=await re.channel.postMessage({type:r,payload:e});return ie.debug("call: response: ",t),t?(re&&t.success&&re.clear(),t):_(w("Method_NoResponse"))}catch(e){return ie.error("call: error",e),re.clear(!1),_(e)}},requestLogin:()=>{throw w("Method_InvalidPackage")},uiResponse:e=>{const{type:t,payload:n}=e;re.channel.postMessage({event:i,type:t,payload:n})},renderWebUSBButton:()=>{},disableWebUSB:()=>{throw w("Method_InvalidPackage")},requestWebUSBDevice:()=>{throw w("Method_InvalidPackage")},cancel:e=>{re&&re.emit(g,e)},dispose:()=>(ne.removeAllListeners(),se=te(),re&&re.close(),Promise.resolve(void 0))});(()=>{const e=new q({name:"trezor-connect-proxy",channel:{here:"@trezor/connect-service-worker-proxy",peer:"@trezor/connect-foreground-proxy"},lazyHandshake:!0,allowSelfOrigin:!0});let t=te();e.init(),e.on("message",(n=>{const{id:s,payload:i,type:o}=n;if(!i)return;const{method:r,settings:a}=i;o!==l?ae.init(t).then((()=>{ae[r](i).then((t=>{e.postMessage({id:s,payload:t.payload})}))})):t=te({...se,...a})}))})();const ce=ae})(),s=s.default})()));